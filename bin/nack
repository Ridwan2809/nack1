#!/usr/bin/env node

require.paths.unshift("/Users/josh/Dropbox/nack/lib")

var config = process.argv[2];
var port   = process.argv[3] || 3000;

var sys = require('sys');

var nack = require('nack');
var pool = nack.createPool(config, {size: 10, idle: 15 * 60 * 1000});

pool.on('spawn', function() {
  nack.logStream(pool.stdout);
  nack.logStream(pool.stderr);
});

var http = require('http');
var server = http.createServer(function (req, res) {
  pool.proxyRequest(req, res);
});

server.listen(port, "127.0.0.1");
sys.puts("Listening on http://127.0.0.1:" + port);
